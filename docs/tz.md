# ТЗ (предварительное) — Sinara: образовательная SaaS-система методик китайского языка

**Версия:** 0.1 (предварительная)  
**Дата:** 2026-02-09  
**Стек:** Next.js + Tailwind + shadcn/ui + Supabase (Auth/Postgres/Storage)  
**Репозиторий:** GitHub

---

## 1. Цели и суть продукта

Sinara — это SaaS-платформа для продажи подписки **учителям/репетиторам/школам** на доступ к методикам преподавания китайского языка.

Платформа предоставляет:
- методики (в MVP — одна методика для начальных классов, 80 уроков);
- личные кабинеты **Учителя** и **Ученика**;
- домашние задания с фиксацией факта выполнения (кол-во просмотров/прослушиваний);
- аналитику выполнения ДЗ и прогресса, сообщения.

---

## 2. Роли и права доступа

### 2.1 Роли
- **Гость** (не авторизован)
- **Пользователь** (авторизован, выбран тип аккаунта)
  - **Учитель**
  - **Ученик**
- **Админ** (внутренний доступ для управления контентом/пользователями/подписками)

### 2.2 Выбор роли при логине
При первом входе после регистрации пользователь выбирает:
- “Ученик”
- “Учитель”

Выбор сохраняется в профиле. Возможность смены роли — **по решению** (по умолчанию: через поддержку/админа, чтобы избежать злоупотреблений).

### 2.3 Подписка и доступ к методикам
- Если у Учителя **активна подписка** → доступ ко всем урокам методики.
- Если подписки **нет** → доступ только к **первому уроку** каждой методики (в MVP — первой методики).
- Ученик получает доступ к урокам/материалам **через назначенные ДЗ** и/или правила доступа (см. раздел “Домашние задания и трекинг”).

---

## 3. Контент: Методика и уроки

### 3.1 Структура методики (MVP)
- В системе существует **1 методика** (начальные классы).
- Методика содержит **80 уроков**.

### 3.2 Страницы и URL
- Страница методики:  
  `/methodics/[methodicSlug]`
- Страница урока:  
  `/methodics/[methodicSlug]/lessons/[lessonSlugOrNumber]`

Каждый урок — отдельная страница со своим URL.

### 3.3 Содержимое урока
На странице урока отображается:
- текст методики (контент урока);
- презентации (файлы или встроенный просмотр);
- видео;
- аудио.

**Требование:** материалы могут быть загружены и связаны с уроком.  
**Хранение:** Supabase Storage (по умолчанию) либо внешние ссылки (если будет нужно).

### 3.4 Ограничение доступа (paywall)
- Учитель без подписки:
  - урок 1 доступен полностью;
  - уроки 2..80 показывают “превью/заглушку” + CTA “Оформить подписку”.
- Учитель с подпиской:
  - доступ ко всем урокам.
- Ученик:
  - доступ определяется политикой (см. 6.2) — минимум: доступ к материалам уроков, которые назначены в ДЗ.

---

## 4. Личный кабинет Учителя

Разделы: **Методики**, **Ученики**, **Обучение** (частично в MVP).

### 4.1 Раздел “Методики”
Функции:
- список методик (в MVP — одна);
- переход на страницу методики и на страницы уроков;
- индикатор подписки/доступа;
- при отсутствии подписки — доступ только к первому уроку.

### 4.2 Раздел “Ученики”
Требования:
- список учеников: индивидуальные + группы;
- возможность:
  - создавать ученика (минимум: имя/фамилия/логин или приглашение ссылкой);
  - создавать группы;
  - добавлять/удалять ученика в группу;
  - фильтровать/сортировать (по группе, статусу, прогрессу, активности, и т.д.);
- карточка ученика/группы:
  - прогресс выполнения ДЗ;
  - посещаемость (в MVP — опционально, можно подготовить структуру без UI);
  - проверка знаний (в MVP — опционально/заглушка);
  - сообщения: написать ученику или группе.

### 4.3 Аналитика (Учитель)
Минимальный набор в MVP:
- по каждому ученику:
  - список назначенных ДЗ;
  - статус выполнения (выполнено/не выполнено/в процессе);
  - фактические счётчики: сколько раз просмотрено видео/презентация, сколько раз прослушано аудио (если задано требование “N раз”).
- по группе:
  - сводная таблица по ученикам (прогресс/выполнение).

### 4.4 Сообщения (Учитель)
- отправка сообщения:
  - одному ученику;
  - группе (массовая рассылка).
- просмотр истории сообщений.

(Реалтайм-чат не обязателен в MVP; достаточно “почтового” формата.)

### 4.5 Раздел “Обучение” (события)
В MVP можно сделать “скелет” раздела + модель данных:
- вебинары по расписанию
- семинары
- онлайн-конференции

MVP-минимум:
- страница со списком событий (пока пусто или 1-2 демо записи),
- структура данных и админское управление (через Supabase/seed).

---

## 5. Личный кабинет Ученика

Разделы:
- **Домашнее задание**
- **Отчет преподавателя**
- **Сообщения от преподавателя**
- **Прогресс**

### 5.1 Домашнее задание (MVP — ключевой раздел)
- список заданий:
  - урок/материал;
  - требования: “посмотреть видео X раз”, “прослушать аудио Y раз”, “посмотреть презентацию Z раз”;
  - дедлайн (опционально);
  - статус выполнения;
- внутри задания:
  - просмотр/прослушивание материалов;
  - отображение прогресса выполнения (например: 3/10).

### 5.2 Прогресс
- агрегированная статистика по ДЗ:
  - выполнено / всего;
  - текущая неделя/месяц (опционально).

### 5.3 Сообщения
- входящие сообщения от учителя;
- возможность ответить — по решению (в MVP можно сделать только входящие).

### 5.4 Отчет преподавателя
- раздел под текстовые отчёты/комментарии учителя по ученику (в MVP опционально как “заглушка” или простая форма).

---

## 6. Домашние задания и трекинг просмотров/прослушиваний (MVP)

### 6.1 Сценарий назначения ДЗ
Учитель должен иметь возможность назначить ученику/группе:
- урок (или конкретный материал урока);
- тип требований:
  - видео: N повторов,
  - аудио: N повторов,
  - презентация: N повторов,
  - (опционально) прочитать текст (без точного трекинга или по кнопке “прочитано”);
- дедлайн (опционально);
- комментарий к заданию (опционально).

### 6.2 Политика доступа ученика к материалам
Варианты (нужно выбрать):
1) Ученик видит материалы **только в контексте ДЗ** (строже).
2) Ученик видит все уроки, доступные учителю (если учитель оплатил) (свободнее).
3) Комбинированно: материалы доступны ученику, если он прикреплён к учителю с подпиской + урок открыт.

**По умолчанию для MVP:** (1) “Доступ к материалам урока через назначенное ДЗ”.

### 6.3 Что считать “просмотром/прослушиванием”
Нужно фиксировать факт выполнения требований “N раз”.

Рекомендуемое определение (MVP):
- **Видео**: засчитывается 1 просмотр, если пользователь:
  - нажал Play,
  - и досмотрел ≥ X% длительности (например, 80%)  
  *(или альтернативно: провёл в плеере ≥ Y секунд, если нет метрик длительности)*
- **Аудио**: засчитывается 1 прослушивание при прослушивании ≥ X% (например, 80%).
- **Презентация**:
  - вариант A (простой): открытие файла + время на странице ≥ N секунд → 1 просмотр;
  - вариант B (лучше): пролистывание до последнего слайда → 1 просмотр.

**Важно:** если материалы встраиваются со сторонних платформ (YouTube/Vimeo), детальный трекинг может быть ограничен. Для точного трекинга предпочтительно хранить медиа в Storage и использовать собственный HTML5-плеер.

### 6.4 Хранение событий трекинга
Система должна записывать события:
- `assignment_id`
- `student_id`
- `asset_type` (video/audio/presentation/text)
- `event_type` (play/complete/open/close)
- `progress_percent` или `duration_seconds`
- `created_at`

На основе событий считается “сколько раз выполнено”.

---

## 7. Подписки и биллинг (MVP/Phase 2)

Поскольку продукт — SaaS, нужна модель подписки.

**В MVP допустимо:**
- хранить статус подписки в БД вручную (админом) для первых клиентов;
- подготовить архитектуру под интеграцию оплаты.

**Phase 2 (рекомендуется):**
- Stripe (или аналог) + вебхуки:
  - создание/обновление подписки;
  - отмена/пауза;
  - хранение `stripe_customer_id`, `stripe_subscription_id`, `status`, `current_period_end`.

---

## 8. Админ-функции (минимально необходимые)

Варианты реализации:
- через Supabase Dashboard (на старте),
- или отдельная админка в приложении.

Минимум:
- управление методиками/уроками/материалами;
- управление пользователями;
- управление подписками (ручная активация на MVP).

---

## 9. Нефункциональные требования

### 9.1 Безопасность и доступ
- Supabase Auth (email/password, опционально OAuth позже).
- RLS (Row Level Security) на ключевых таблицах:
  - учитель видит только своих учеников/группы/сообщения/назначения;
  - ученик видит только свои ДЗ/сообщения/события.
- Защита контента от прямых ссылок:
  - приватные файлы в Storage;
  - выдача подписанных URL (signed URLs) на скачивание/просмотр.

### 9.2 Производительность
- кэширование публичных страниц (если появятся);
- lazy loading медиа;
- пагинация списков (ученики/сообщения/уроки при росте).

### 9.3 Логи и аудит
- базовый аудит действий учителя (опционально): назначил ДЗ, отправил сообщение.

### 9.4 Локализация
- интерфейс RU (в MVP), возможность добавить EN/CN позже.

---

## 10. Техническая архитектура (предложение)

### 10.1 Frontend
- Next.js (App Router)
- Tailwind + shadcn/ui
- Состояния: server components + client components, где нужно (плееры, трекинг, формы)

### 10.2 Backend (Supabase)
- Postgres: сущности, связи, аналитика
- Storage: видео/аудио/презентации
- Edge Functions (опционально):
  - генерация signed URLs,
  - webhook Stripe,
  - batch-агрегация статистики.

---

## 11. Предложение по модели данных (черновик)

### 11.1 Пользователи и роли
- `profiles`:
  - `id` (uuid, = auth.users.id)
  - `role` (teacher|student|admin)
  - `name`
  - `created_at`

### 11.2 Методики/уроки/материалы
- `methodics`:
  - `id`, `slug`, `title`, `description`
- `lessons`:
  - `id`, `methodic_id`, `number`, `slug`, `title`, `content_md`
- `lesson_assets`:
  - `id`, `lesson_id`, `type` (video|audio|presentation)
  - `title`
  - `storage_path` или `external_url`
  - `duration_seconds` (если известно)

### 11.3 Ученики/группы/привязка
- `teacher_students`:
  - `id`, `teacher_id`, `student_id`, `created_at`
- `groups`:
  - `id`, `teacher_id`, `title`
- `group_members`:
  - `group_id`, `student_id`

### 11.4 Домашние задания
- `assignments`:
  - `id`
  - `teacher_id`
  - `student_id` (nullable, если на группу)
  - `group_id` (nullable)
  - `lesson_id`
  - `required_video_views` (int, default 0)
  - `required_audio_plays` (int, default 0)
  - `required_presentation_views` (int, default 0)
  - `due_at` (nullable)
  - `created_at`
- `assignment_events`:
  - `id`, `assignment_id`, `student_id`
  - `asset_type` (video|audio|presentation)
  - `event_type` (open|play|progress|complete)
  - `progress_percent` (nullable)
  - `duration_seconds` (nullable)
  - `created_at`

### 11.5 Сообщения
- `messages`:
  - `id`, `teacher_id`, `subject`, `body`, `created_at`
- `message_recipients`:
  - `message_id`, `student_id` (или group_id + денормализация по участникам)

### 11.6 Подписки
- `subscriptions`:
  - `id`, `teacher_id`
  - `status` (active|trialing|past_due|canceled|none)
  - `provider` (manual|stripe)
  - `provider_customer_id` (nullable)
  - `provider_subscription_id` (nullable)
  - `current_period_end` (nullable)

---

## 12. MVP-объём работ (scope)

### Обязательное (Must)
- Регистрация/логин
- Выбор роли (ученик/учитель)
- Учитель:
  - методика (1 шт) + уроки (80) + страницы уроков
  - доступ по подписке (paywall)
  - ученики/группы (минимальный CRUD + фильтры)
  - назначение ДЗ (урок + требования N раз)
  - просмотр прогресса выполнения ДЗ
  - сообщения ученику/группе
- Ученик:
  - список ДЗ
  - выполнение ДЗ (просмотр/прослушивание) + трекинг
  - прогресс
  - входящие сообщения

### Желательно (Should)
- Отчёт преподавателя
- Расширенная аналитика (графики, динамика)
- События “Обучение” (вебинары) хотя бы как список

### Можно позже (Could)
- Полноценная платёжка (Stripe) + self-serve
- Тестирование знаний, посещаемость как отдельные модули
- Реалтайм-чат
- Мульти-методики и маркетплейс методик
- Роли “Школа/Организация”, несколько учителей в одной школе

---

## 13. Критерии приёмки (коротко)

1) Учитель без подписки видит полностью только урок 1, остальные уроки закрыты paywall.  
2) Учитель с активной подпиской видит все 80 уроков и материалы.  
3) Учитель назначает ученику ДЗ: “видео 10 раз”, ученик выполняет, система фиксирует события, учитель видит прогресс 0..10.  
4) Учитель может отправить сообщение ученику и группе, ученик видит входящие.  
5) Ученик видит список ДЗ и прогресс выполнения по каждому.

---

## 14. Вопросы/допущения (нужно уточнить)

1) Как ученик попадает к учителю: приглашение ссылкой, код, email-инвайт, ручное добавление?  
2) Ученику нужен самостоятельный доступ к урокам или только через ДЗ? (см. 6.2)  
3) Где будут храниться видео/аудио/презентации: Supabase Storage или внешние платформы?  
4) Подписка: какие тарифы (учитель/школа), период (месяц/год), нужны ли пробные периоды?  
5) Нужна ли роль “Школа” (организация с несколькими учителями) в MVP или позже?  
6) Нужно ли ученику отвечать на сообщения учителя (двусторонняя переписка) в MVP?  
7) Что считается “просмотром презентации” — достаточно открыть или надо пролистать до конца?

---

## 15. Рекомендуемая структура репозитория для документации

- `docs/tz.md` — текущее ТЗ  
- `docs/roadmap.md` — план релизов  
- `docs/db-schema.md` — актуальная схема БД (по мере стабилизации)  
- `docs/api.md` — контракты/эндпоинты/события (если появятся)

---
